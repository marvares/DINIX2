---
title: "Informe Estandarizaci칩n Per칰 Escala INDI, Parte 3: An치lisis de Asociaciones"
subtitle: "Muestra Nivel 4-5"
author: "Mart칤n Vargas Estrada"
date: "`r Sys.time()`"
output:
  pdf_document:
    toc: true
    toc_depth: 4
  word_document:
    toc: true
    toc_depth: '4'
  html_document:
    toc: true
    toc_depth: '4'
    df_print: paged
header-includes: \renewcommand{\contentsname}{칈ndice} \renewcommand{\tablename}{Tabla}
---
\newpage

# Introducci칩n


Informe de Exploraci칩n Psicom칠trica de los 칣tems de la prueba INDI obtenidas con muestra de Per칰, Niveles 4-5. 

```{r 45_P3_DATAFRAME, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

library(tidyverse)
library(haven)
rm(list = ls()) 
# Carga el archivo .sav
INDI45 <- read_sav("INDI45.sav")

invertir_y_sumar <- function(df, indices_inversos, nombre_variable_sumatoria, posicion_variable) {
  
  # Asegurar que df sea un tibble para evitar problemas con select()
  df <- as_tibble(df)
  
  # 1. Convertir columnas 75:88 a num칠ricas
  df <- df %>%
    mutate(across(74:86, as.numeric))
  
  # 2. Invertir los 칤tems indicados
  df <- df %>%
    mutate(across(indices_inversos, ~ 7 - .x))
  
  # 3. Crear la variable sumatoria
  df <- df %>%
    mutate(!!nombre_variable_sumatoria := rowSums(across(74:86)))
  
  # 4. Reubicar la variable sumatoria en la posici칩n deseada
  col_order <- names(df)  # Obtener nombres de columnas
  col_order <- setdiff(col_order, nombre_variable_sumatoria)  # Remover sumatoria si ya est치
  col_order <- append(col_order, nombre_variable_sumatoria, after = posicion_variable - 1)  # Insertar en posici칩n
  
  # 游늷 Reordenar usando 칤ndice de columnas en lugar de dplyr::select()
  df <- df[, col_order]  # 拘勇 Esto funciona siempre

  return(df)
}





# Ejemplo
# Aplicar la funci칩n con los valores indicados
INDI45_i <- invertir_y_sumar(
  df = INDI45,
  indices_inversos = c(77:80, 84:88),  # 칈tems inversos
  nombre_variable_sumatoria = "SSUM",  # Nombre de la variable sumatoria
  posicion_variable = 104  # Ubicaci칩n deseada
)

```


# An치lisis de Asociaciones entre el valor de las Escalas  y las Variables Demogr치ficas

## Fecha de Evaluaci칩n y Escalas INDI

Tenemos cuatro fechas de evaluaci칩n de participantes, correspondientes a los meses de abril, mayo, junio y agosto 2024.

```{r 45_P3_FECHIN, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

# DFs Num칠rico
# Funci칩n para extraer la data num칠rica sin NA's de un df

ayudin <- function(dataframe, columnas) {
  # Verificar que las columnas seleccionadas sean num칠ricas
  if (!all(sapply(columnas, function(col) is.numeric(dataframe[[col]])))) {
    stop("Todas las columnas seleccionadas deben ser num칠ricas.")
  }
  
  # Filtrar el dataframe eliminando filas con NA en las columnas seleccionadas
  dataframe_limpio <- dataframe[complete.cases(dataframe[, columnas]), columnas]
  
  # Devolver el dataframe limpio
  return(dataframe_limpio)
}

# Not necessarily, but oftentimes one should transform all relevant columns to numeric in order for the function to work properly. So this is how to do just that:


# Llamar a la funci칩n y mostrar los resultados
LIMPIO <- ayudin(dataframe = INDI45_i, columnas = c(1, 102:105))

# DF Categorial

# 1. Extraigo los campos categ칩ricos que me interesan del df original

INDI45_i$Fechin <- factor(INDI45_i$Fechin) 
library(dplyr)
INDI45_FECHIN <- INDI45_i %>% 
  dplyr::select(Codigo, Fechin)

PULCRO <- left_join(LIMPIO, INDI45_FECHIN,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Fechin, .before = CSUM) # Este ser치 el df que usar칠 para esta asociaci칩n en espec칤fico
# La pregunta es: 쯔침ado la columna de sumatoria de la escala S? Por el momento no lo har칠, ya que los autores no lo hicieron para esta muestra. Puede que haya algunas razones, adem치s de la pobre performance de varios 칤tems de esa subescala, para no crear un 칤ndice sumatorio. Puede que el constructo no lo requiera.
# Supongamos que tienes un dataframe llamado df
# Let's beautify these figures
library(forcats)
# Recodificar niveles
PULCRO$Fechin <- fct_recode(PULCRO$Fechin,
                        "Abr." = "2024-04-29",
                        "May." = "2024-05-20",
                        "Jun." = "2024-06-17",
                        "Ago." = "2024-08-12")

colnames(PULCRO) <- c("C칩digo", "Fecha_Eval", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")

# En este caso vamos a aplicar un an치lisis ANOVA, que suele ser el apropiado cuando tenemos que medir la asociaci칩n entre una variable categ칩rica y una variabler num칠rica. El ANOVA robusto basado en medias recortadas (Trimmed Means ANOVA) es una excelente opci칩n para situaciones en las que los datos no cumplen con los supuestos de normalidad o est치n influenciados por valores at칤picos.

# Instalar el paquete 
# install.packages("WRS2")

# Cargar el paquete
# library(WRS2)
# # Aplicar el ANOVA robusto basado en medias recortadas
# fechin.csum <- t1way(PULCRO$CSUM ~ PULCRO$Fechin, data = PULCRO)
# 
# # Mostrar los resultados
# print(fechin.csum)

# Proceder칠 a generar una funci칩n para evaluar el Trimmed ANOVA y dar los resultados en una tabla:

# Cargar los paquetes necesarios
if (!require("WRS2")) install.packages("WRS2")
if (!require("dplyr")) install.packages("dplyr")
if (!require("knitr")) install.packages("knitr")

# Definir la funci칩n corregida
trimmed_anova <- function(df, cat_var, num_vars, trim_level = 0.20) {
  # 1. Verificar que la variable categ칩rica est칠 en formato factor
  if (!is.factor(df[[cat_var]])) {
    stop("La variable categ칩rica debe estar en formato factor. Usa factor() para convertirla.")
  }
  
  # 2. Verificar que las variables num칠ricas est칠n en formato num칠rico
  num_var_names <- names(df)[num_vars]
  non_numeric_vars <- num_var_names[!sapply(df[num_vars], is.numeric)]
  
  if (length(non_numeric_vars) > 0) {
    stop(paste("Las siguientes variables no son num칠ricas:", paste(non_numeric_vars, collapse = ", ")))
  }
  
  # 3. Crear un dataframe vac칤o para almacenar los resultados
  resultados <- data.frame(
    Variable = character(),
    P_valor = character(),
    Efecto = numeric(),
    Interpretaci칩n = character(),
    stringsAsFactors = FALSE
  )
  
  # 4. Loop a trav칠s de cada variable num칠rica y aplicar Trimmed ANOVA
  for (var_name in num_var_names) {
    # Aplicar Trimmed ANOVA
    formula <- as.formula(paste(var_name, "~", cat_var))
    anova_result <- t1way(formula, data = df, tr = trim_level)
    
    # Extraer valores relevantes
    p_value <- anova_result$p.value
    effect_size <- anova_result$effsize
    
    # Anotaciones para el valor p
    p_label <- ifelse(p_value < 0.001, "***",
               ifelse(p_value < 0.01, "**",
               ifelse(p_value < 0.05, "*", "NS")))
    
    # Interpretaci칩n del tama침o del efecto
    interpretacion <- ifelse(effect_size >= 0.14, "Efecto muy grande",
                      ifelse(effect_size >= 0.06, "Efecto mediano",
                      ifelse(effect_size >= 0.01, "Efecto peque침o", "Ninguno")))
    
    # Crear una nueva fila con los resultados
    nueva_fila <- data.frame(
      Variable = var_name,
      P_valor = paste0(formatC(p_value, format = "f", digits = 3), " ", p_label),
      Efecto = round(effect_size, 2),
      Interpretaci칩n = interpretacion,
      stringsAsFactors = FALSE
    )
    
    # Agregar la fila al dataframe de resultados
    resultados <- rbind(resultados, nueva_fila)
  }
  
  # 5. Crear el t칤tulo din치mico
  titulo <- paste(
    "Resultados del An치lisis de Asociaci칩n entre", 
    cat_var, 
    "y", 
    paste(num_var_names, collapse = ", ")
  )
  
  # 6. Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("###", titulo, "\n\n") # Imprimir el t칤tulo como encabezado
  return(knitr::kable(resultados, format = "markdown", align = "lccc"))
}



# Usar la funci칩n trimmed_anova
fechin.anal <- trimmed_anova(
  df = PULCRO,             # Tu dataframe
  cat_var = "Fecha_Eval",      # Variable categ칩rica en formato factor
  num_vars = c(3:6),    # 칈ndices de las variables num칠ricas
  trim_level = 0.10        # Nivel de recorte (opcional, por defecto 0.20)
)

# Mostrar el resultado
print(fechin.anal)

```

Estos resultados nos indican que los grupos evaluados en las cuatro fechas de recolecci칩n difieren de forma estad칤sticamente significativa entre s칤. A continuaci칩n, pasaremos a profundizar en el an치lisis, a fin de determinar cu치les son los grupos que realmente difieren.

Empezaremos analizando el detalle de las diferencias grupales para el caso de la Escala Cognitiva.  
  
### An치lisis Posthoc: Escala Cognitiva seg칰n Fechas de Evaluaci칩n

Como vemos en el gr치fico siguiente, incluso a nivel visual puede constatarse la existencia de diferencias notables en el desempe침o de los participantes en la Escala Cognitiva. 

```{r 45_P3_FECHIN_posthoc_CSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

# Definir la funci칩n para crear el gr치fico de barras
# Instalar y cargar los paquetes necesarios (si no est치n instalados)
library(ggplot2)
library(RColorBrewer)

# Definir la funci칩n para crear el gr치fico de barras
grafico_promedio <- function(data, var_numerica, var_categorica, 
                             color_contorno = "black", 
                             paleta_colores = "Set3", 
                             nuevo_nombre_categoria = var_categorica) {
  
  # Calcular el promedio de la variable num칠rica por la variable categ칩rica
  resumen <- aggregate(data[[var_numerica]], by = list(data[[var_categorica]]), FUN = mean)
  colnames(resumen) <- c(nuevo_nombre_categoria, "Promedio")
  
  # Crear el gr치fico de barras
  ggplot(resumen, aes_string(x = nuevo_nombre_categoria, y = "Promedio")) +
    geom_bar(stat = "identity", fill = brewer.pal(n = length(unique(data[[var_categorica]])), name = paleta_colores), 
             color = color_contorno) +
    geom_text(aes(label = round(Promedio, 2)), vjust = -0.5) +
    labs(title = paste("Promedio de", var_numerica, "por", nuevo_nombre_categoria),
         x = nuevo_nombre_categoria,
         y = paste("Promedio de", var_numerica)) +
    theme_gray()
}

# Ejemplo de uso
# Suponiendo que 'df' es tu dataframe y contiene las columnas 'calificaciones' y 'escuela'
# grafico_promedio(df, "calificaciones", "escuela", color_contorno = "blue", paleta_colores = "Set1", nuevo_nombre_categoria = "Escuelas")

ph_CSUM_FECHIN <- grafico_promedio(PULCRO, "Escala_Cog.", "Fecha_Eval", color_contorno = "black", paleta_colores = "Blues", nuevo_nombre_categoria = "Fecha_Evaluaci칩n")
cat("\n\n")
print(ph_CSUM_FECHIN)

ph.csum <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. |   p Valor   |              Interpretaci칩n              |
|:-------:|:-------:|--------------:|------:|:-----------------------------------------|
| Abr.    | May.    | -12.34        | <.001 | Dif. Estad칤sticamente significativa      |
| Abr.    | Jun.    | -9.94         | <.001 | Dif. Estad칤sticamente significativa      |
| Abr.    | Ago.    | -30.46        | <.001 | Dif. Estad칤sticamente significativa      |
| May.    | Jun.    | 2.41          | 0.172 | Sin Dif. Estad칤sticamente significativa  |
| May.    | Ago.    | -18.12        | <.001 | Dif. Estad칤sticamente significativa      |
| Jun.    | Ago.    | -20.53        | <.001 | Dif. Estad칤sticamente significativa      |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Cog.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.csum)
```

La Tabla anterior nos indica que, ya al nivel de la Escala Cognitiva, pr치cticamente todos los grupos participantes muestran diferencias estad칤sticamente significativas, con la excepci칩n de los grupos evaluados en Mayo y Junio, entre los cuales parece no haber diferencia estad칤sticamente significativa.

### An치lisis Posthoc: Escala Motora seg칰n Fechas de Evaluaci칩n

Como en el caso anterior, gr치ficamente tambi칠n es posible detectar a simple vista grandes diferencias grupales en la Escala Motora.  

```{r 45_P3_FECHIN_posthoc_MSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

# Definir la funci칩n para crear el gr치fico de barras
# Instalar y cargar los paquetes necesarios (si no est치n instalados)
library(ggplot2)
library(RColorBrewer)

# Definir la funci칩n para crear el gr치fico de barras
grafico_promedio <- function(data, var_numerica, var_categorica, 
                             color_contorno = "black", 
                             paleta_colores = "Set3", 
                             nuevo_nombre_categoria = var_categorica) {
  
  # Calcular el promedio de la variable num칠rica por la variable categ칩rica
  resumen <- aggregate(data[[var_numerica]], by = list(data[[var_categorica]]), FUN = mean)
  colnames(resumen) <- c(nuevo_nombre_categoria, "Promedio")
  
  # Crear el gr치fico de barras
  ggplot(resumen, aes_string(x = nuevo_nombre_categoria, y = "Promedio")) +
    geom_bar(stat = "identity", fill = brewer.pal(n = length(unique(data[[var_categorica]])), name = paleta_colores), 
             color = color_contorno) +
    geom_text(aes(label = round(Promedio, 2)), vjust = -0.5) +
    labs(title = paste("Promedio de", var_numerica, "por", nuevo_nombre_categoria),
         x = nuevo_nombre_categoria,
         y = paste("Promedio de", var_numerica)) +
    theme_gray()
}

# Ejemplo de uso
# Suponiendo que 'df' es tu dataframe y contiene las columnas 'calificaciones' y 'escuela'
# grafico_promedio(df, "calificaciones", "escuela", color_contorno = "blue", paleta_colores = "Set1", nuevo_nombre_categoria = "Escuelas")

ph_MSUM_FECHIN <- grafico_promedio(PULCRO, "Escala_Mot.", "Fecha_Eval", color_contorno = "black", paleta_colores = "Greens", nuevo_nombre_categoria = "Fecha_Evaluaci칩n")
cat("\n\n")
print(ph_MSUM_FECHIN)

ph.msum <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. | p Valor |            Interpretaci칩n            |
|---------|---------|:-------------:|:-------:|:------------------------------------:|
| Abr.    | May.    | -4.22         |   <.001 | Dif. Estad칤sticamente significativa  |
| Abr.    | Jun.    | -2.68         |   <.001 | Dif. Estad칤sticamente significativa  |
| Abr.    | Ago.    | -5.54         |   <.001 | Dif. Estad칤sticamente significativa  |
| May.    | Jun.    | 1.55          |   <.001 | Dif. Estad칤sticamente significativa  |
| May.    | Ago.    | -1.32         |   <.001 | Dif. Estad칤sticamente significativa  |
| Jun.    | Ago.    | -2.86         |   <.001 | Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.msum)
```
Si bien cabe se침alar que el patr칩n de diferencias es muy similar, en esta escala todas las diferencias son estad칤sticamente significativas. 



### An치lisis Posthoc: Escala Socioemocional seg칰n Fechas de Evaluaci칩n

Como en el caso anterior, gr치ficamente tambi칠n es posible detectar a simple vista grandes diferencias grupales en la Escala Socioemocional.  

```{r 45_P3_FECHIN_posthoc_SSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

# Definir la funci칩n para crear el gr치fico de barras
# Instalar y cargar los paquetes necesarios (si no est치n instalados)
library(ggplot2)
library(RColorBrewer)

# Definir la funci칩n para crear el gr치fico de barras
grafico_promedio <- function(data, var_numerica, var_categorica, 
                             color_contorno = "black", 
                             paleta_colores = "Set3", 
                             nuevo_nombre_categoria = var_categorica) {
  
  # Calcular el promedio de la variable num칠rica por la variable categ칩rica
  resumen <- aggregate(data[[var_numerica]], by = list(data[[var_categorica]]), FUN = mean)
  colnames(resumen) <- c(nuevo_nombre_categoria, "Promedio")
  
  # Crear el gr치fico de barras
  ggplot(resumen, aes_string(x = nuevo_nombre_categoria, y = "Promedio")) +
    geom_bar(stat = "identity", fill = brewer.pal(n = length(unique(data[[var_categorica]])), name = paleta_colores), 
             color = color_contorno) +
    geom_text(aes(label = round(Promedio, 2)), vjust = -0.5) +
    labs(title = paste("Promedio de", var_numerica, "por", nuevo_nombre_categoria),
         x = nuevo_nombre_categoria,
         y = paste("Promedio de", var_numerica)) +
    theme_gray()
}

# Ejemplo de uso
# Suponiendo que 'df' es tu dataframe y contiene las columnas 'calificaciones' y 'escuela'
# grafico_promedio(df, "calificaciones", "escuela", color_contorno = "blue", paleta_colores = "Set1", nuevo_nombre_categoria = "Escuelas")

ph_SSUM_FECHIN <- grafico_promedio(PULCRO, "Escala_Soc", "Fecha_Eval", color_contorno = "black", paleta_colores = "Greens", nuevo_nombre_categoria = "Fecha_Evaluaci칩n")
cat("\n\n")
print(ph_SSUM_FECHIN)
# Exportar un dataframe a un archivo CSV
# write.csv(PULCRO, "FECHIN_SOCIO.csv", row.names = FALSE)


ph.ssum <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. |  p Valor | Interpretaci칩n                         |
|---------|---------|---------------:|---------:|----------------------------------------|
| Abr.    | Ago.    |         -5.859 |    <.001 | Dif. Estad칤sticamente significativa    |
| Abr.    | Jun.    |         -5.013 |    <.001 | Dif. Estad칤sticamente significativa    |
| Abr.    | May.    |         -5.534 |    <.001 | Dif. Estad칤sticamente significativa    |
| Ago.    | Jun.    |          0.846 |    0.372 | Dif. No Estad칤sticamente significativa |
| Ago.    | May.    |          0.324 |    0.608 | Dif. No Estad칤sticamente significativa |
| Jun.    | May.    |         -0.522 |    0.608 | Dif. No Estad칤sticamente significativa |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.ssum)
```
Si bien cabe se침alar que el patr칩n de diferencias es muy similar, en esta escala no todas las diferencias son estad칤sticamente significativas.



### An치lisis Posthoc: Escala Disposicional seg칰n Fechas de Evaluaci칩n

En esta secci칩n pasamos a analizar cu치les de las diferencias intergrupales son estad칤sticamente significativas.

```{r 45_P3_FECHIN_posthoc_DSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

# Definir la funci칩n para crear el gr치fico de barras
# Instalar y cargar los paquetes necesarios (si no est치n instalados)
library(ggplot2)
library(RColorBrewer)


ph_DSUM_FECHIN <- grafico_promedio(PULCRO, "Escala_Dis.", "Fecha_Eval", color_contorno = "black", paleta_colores = "Oranges", nuevo_nombre_categoria = "Fecha_Evaluaci칩n")
cat("\n\n")
print(ph_DSUM_FECHIN)

ph.dsum <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. | p Valor |              Interpretaci칩n              |
|---------|---------|:--------------:|:-------:|:----------------------------------------:|
| Abr.    | May.    | -3.8547        |   <.001 | Dif. Estad칤sticamente significativa      |
| Abr.    | Jun.    | -2.9754        |   <.001 | Dif. Estad칤sticamente significativa      |
| Abr.    | Ago.    | -3.8914        |   <.001 | Dif. Estad칤sticamente significativa      |
| May.    | Jun.    | 0.8793         |   0.012 | Sin Dif. Estad칤sticamente significativa  |
| May.    | Ago.    | -0.0366        |   0.915 | Sin Dif. Estad칤sticamente significativa  |
| Jun.    | Ago.    | -0.9160        |   0.007 | Sin Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Dis.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.dsum)
```

En esta ocasi칩n, podemos ver que claramente es el grupo evaluado en Abril el que evidencia puntajes m치s bajos que el resto de los grupos, mientras que estos forman un grupo comparativamente homog칠neo. 

\newpage

## Cuatrimestre de Nacimiento y Escalas INDI

```{r 45_P3_QDOB, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results = 'asis'}

# Clasificamos los casos seg칰n el cuatrimestre de nacimiento

# Definici칩n de la funci칩n
library(dplyr)
en_cuatro <- function(dataframe, columna_fechas) {
  # Convertir la columna de fechas de character a Date
  dataframe[[columna_fechas]] <- as.Date(dataframe[[columna_fechas]], format = "%m/%d/%Y")
  
  # Crear la nueva variable QDOB inmediatamente despu칠s de la columna de fechas
  columna_pos <- which(names(dataframe) == columna_fechas) # Obtener la posici칩n de la columna de fechas
  dataframe <- dataframe %>%
    mutate(QDOB = cut(
      as.numeric(format(.data[[columna_fechas]], "%m")),  # Extraer el mes
      breaks = c(0, 3, 6, 9, 12),                        # Definir los l칤mites de los cuatrimestres
      labels = c("1 (Ene-Mar)", "2 (Abr-Jun)", "3 (Jul-Sep)", "4 (Oct-Dic)"), # Etiquetas para los cuatrimestres
      include.lowest = TRUE                              # Incluir el l칤mite inferior (enero)
    )) %>%
    relocate(QDOB, .after = all_of(columna_fechas))      # Mover QDOB justo despu칠s de la columna de fechas
  
  # Convertir la nueva variable a factor (opcional, ya hecho en cut)
  dataframe$QDOB <- as.factor(dataframe$QDOB)
  
  return(dataframe)
}

# Uso de la funci칩n
INDI45_i <- en_cuatro(INDI45_i, "Fecnac")

# 1. Extraigo los campos categ칩ricos que me interesan del df original
library(dplyr)
INDI45_QDOB <- INDI45_i %>% 
  dplyr::select(Codigo, QDOB)

PULCRO <- left_join(LIMPIO, INDI45_QDOB,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(QDOB, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Cuatrimestre", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")
# Ahora eval칰o la asociaci칩n entre Cuiatrimestre y las escalas... chanchachach치n!!!
# Usar la funci칩n trimmed_anova
encuatro.anal <- trimmed_anova(
  df = PULCRO,             # Tu dataframe
  cat_var = "Cuatrimestre",      # Variable categ칩rica en formato factor
  num_vars = c(3:6),    # 칈ndices de las variables num칠ricas
  trim_level = 0.10        # Nivel de recorte (opcional, por defecto 0.20)
)

# Mostrar el resultado
print(encuatro.anal)
# write_csv(PULCRO, "PULCRO_ENCUATRO.CSV")
```

Vemos que en este caso, en los cuatro puntajes existe una diferencia estad칤sticamente significativa seg칰n el cuatrimestre de nacimiento del participante.

Pasemos a analizar, para cada Escala, en qu칠 grupos se encuentra esas diferencias. 

### An치lisis Posthoc: Escala Cognitiva seg칰n Cuatrimestre de Nacimiento

Tratemos ahora de determinar cu치les de las posibles diferencias intergrupales son estad칤sticamente significativas.

```{r 45_P3_CUATRIMESTRE_posthoc_CSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_CSUM_QDOB <- grafico_promedio(PULCRO, "Escala_Cog.", "Cuatrimestre", color_contorno = "black", paleta_colores = "Blues", nuevo_nombre_categoria = "Cuatrimestre_Nac")
cat("\n\n")
print(ph_CSUM_QDOB)

ph.csum.qdob <- c("| Grupo 1     | Grupo 2     | Dif. Est. Rec. | p Valor |            Interpretaci칩n            |
|-------------|-------------|---------------:|--------:|:------------------------------------:|
| 1 (Ene-Mar) | 2 (Abr-Jun) |         -13.37 |   <.001 | Dif. Estad칤sticamente significativa  |
| 1 (Ene-Mar) | 3 (Jul-Sep) |          -7.56 |   <.001 | Dif. Estad칤sticamente significativa  |
| 1 (Ene-Mar) | 4 (Oct-Dic) |          -3.23 |   0.047 | Dif. Estad칤sticamente significativa  |
| 2 (Abr-Jun) | 3 (Jul-Sep) |           5.80 |   0.003 | Dif. Estad칤sticamente significativa  |
| 2 (Abr-Jun) | 4 (Oct-Dic) |          10.13 |   <.001 | Dif. Estad칤sticamente significativa  |
| 3 (Jul-Sep) | 4 (Oct-Dic) |           4.33 |   0.021 | Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Cog.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.csum.qdob)
```

### An치lisis Posthoc: Escala Motora seg칰n Cuatrimestre de Nacimiento


Pasemos a analizar las diferencias grupales en esta escala.

```{r 45_P3_CUATRIMESTRE_posthoc_MSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_MSUM_QDOB <- grafico_promedio(PULCRO, "Escala_Mot.", "Cuatrimestre", color_contorno = "black", paleta_colores = "Greens", nuevo_nombre_categoria = "Cuatrimestre_Nac")
cat("\n\n")
print(ph_MSUM_QDOB)

ph.msum.qdob <- c("| Grupo 1     | Grupo 2     | Dif. Est. Rec. | p Valor | Interpretaci칩n                           |
|-------------|-------------|---------------:|--------:|------------------------------------------|
| 1 (Ene-Mar) | 2 (Abr-Jun) |         -2.955 |   <.001 | Dif. Estad칤sticamente significativa      |
| 1 (Ene-Mar) | 3 (Jul-Sep) |         -1.862 |   <.001 | Dif. Estad칤sticamente significativa      |
| 1 (Ene-Mar) | 4 (Oct-Dic) |         -0.570 |   0.121 | Sin Dif. Estad칤sticamente significativa  |
| 2 (Abr-Jun) | 3 (Jul-Sep) |          1.094 |   0.006 | Dif. Estad칤sticamente significativa      |
| 2 (Abr-Jun) | 4 (Oct-Dic) |          2.385 |   <.001 | Dif. Estad칤sticamente significativa      |
| 3 (Jul-Sep) | 4 (Oct-Dic) |          1.292 |   0.001 | Dif. Estad칤sticamente significativa      |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.msum.qdob)
```



\newpage

### An치lisis Posthoc: Escala Socioemocional seg칰n Cuatrimestre de Nacimiento

Pasemos a analizar las diferencias grupales en esta escala.

```{r 45_P3_CUATRIMESTRE_posthoc_SSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_SSUM_QDOB <- grafico_promedio(PULCRO, "Escala_Soc", "Cuatrimestre", color_contorno = "black", paleta_colores = "Purples", nuevo_nombre_categoria = "Cuatrimestre_Nac")
cat("\n\n")
print(ph_SSUM_QDOB)
# write.csv(PULCRO, "pulcro_cuatri_45.csv", row.names = FALSE)

ph.ssum.qdob <- c("| Grupo 1     | Grupo 2     | Dif. Est. Rec. |  p Valor | Interpretaci칩n                         |
|-------------|-------------|---------------:|---------:|----------------------------------------|
| 1 (Ene-Mar) | 2 (Abr-Jun) |          -3.45 |    <.001 | Dif. Estad칤sticamente significativa    |
| 1 (Ene-Mar) | 3 (Jul-Sep) |          -2.27 |    <.001 | Dif. Estad칤sticamente significativa    |
| 1 (Ene-Mar) | 4 (Oct-Dic) |          -1.22 |    0.079 | Dif. No Estad칤sticamente significativa |
| 2 (Abr-Jun) | 3 (Jul-Sep) |           1.19 |    0.079 | Dif. No Estad칤sticamente significativa |
| 2 (Abr-Jun) | 4 (Oct-Dic) |           2.23 |    <.001 | Dif. Estad칤sticamente significativa    |
| 3 (Jul-Sep) | 4 (Oct-Dic) |           1.05 |    0.079 | Dif. No Estad칤sticamente significativa |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.ssum.qdob)
```

- El Grupo 1 (Ene-Mar) tiende a diferenciarse significativamente de los Grupos 2 y 3, pero no del Grupo 4.

- El Grupo 2 (Abr-Jun) se diferencia significativamente del Grupo 1 y del Grupo 4, pero no del Grupo 3.

- El Grupo 3 (Jul-Sep) y Grupo 4 (Oct-Dic) no presentan diferencias estad칤sticamente significativas.

En t칠rminos generales, parece que los nacidos en Enero-Marzo tienen valores menores en comparaci칩n con los nacidos en otros per칤odos, mientras que los nacidos en Abril-Junio tienden a tener valores mayores, especialmente en comparaci칩n con los nacidos en Octubre-Diciembre.

\newpage

### An치lisis Posthoc: Escala Disposicional seg칰n Cuatrimestre de Nacimiento

Pasemos a analizar las diferencias grupales en esta escala.

```{r 45_P3_CUATRIMESTRE_posthoc_DSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_DSUM_QDOB <- grafico_promedio(PULCRO, "Escala_Dis.", "Cuatrimestre", color_contorno = "black", paleta_colores = "Oranges", nuevo_nombre_categoria = "Cuatrimestre_Nac")
cat("\n\n")
print(ph_DSUM_QDOB)

ph.dsum.qdob <- c("|   Grupo 1   |   Grupo 2   | Dif. Est. Rec. | p Valor | Interpretaci칩n                           |
|:-----------:|:-----------:|---------------:|--------:|------------------------------------------|
| 1 (Ene-Mar) | 2 (Abr-Jun) |         -2.422 |   <.001 | Dif. Estad칤sticamente significativa      |
| 1 (Ene-Mar) | 3 (Jul-Sep) |         -1.420 |   <.001 | Dif. Estad칤sticamente significativa      |
| 1 (Ene-Mar) | 4 (Oct-Dic) |         -0.605 |   0.059 | Sin Dif. Estad칤sticamente significativa  |
| 2 (Abr-Jun) | 3 (Jul-Sep) |          1.002 |   0.005 | Dif. Estad칤sticamente significativa      |
| 2 (Abr-Jun) | 4 (Oct-Dic) |          1.817 |   <.001 | Dif. Estad칤sticamente significativa      |
| 3 (Jul-Sep) | 4 (Oct-Dic) |          0.815 |   0.027 | Dif. Estad칤sticamente significativa      |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Dis.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.dsum.qdob)
```

El patr칩n que emerge de estas comparaciones grupales indica que los participantes nacidos en el segundo cuatrimestre del a침o (Abril a Junio) suelen tener mejores puntuaciones que los ni침os nacidos durante los tres primeros meses del a침o. Esta diferencia es estad칤sticamente significativa, es decir, podemos descartar que se trate de un simple "casualidad" o peculiaridad de los datos. 

Ya desde el punto de vista interpretativo, 쯤u칠 puede significar este dato? Es probable que el factor madurativo interact칰e con el apoyo que los padres brindan al ni침o: los ni침os nacidos en el primer cuatrimestre del a침o ser칤an ligeramente mayores que los ni침os nacidos en meses ulteriores. Los padres asumir칤an que los ni침os ligeramente mayores ser칤an m치s maduros y, por lo tanto, no tendr칤an tanta necesidad de su intervenci칩n y apoyo. Por el contrario, los ni침os nacidos en meses posteriores ser칤an percibidos por los padres como menos maduros y, por ende, recibir칤an mayor apoyo e involucramiento, lo cual resultar칤a en mejores resultados en instrumentos de evaluaci칩n como el INDI.

Sin embargo, el analista considera que a칰n es necesario ahondar m치s en estos resultados; por ejemplo, habr칤a que realizar un control o segmentamiento por a침o de nacimiento, Nivel, etc. 
\newpage

## Edad en Meses y Escalas INDI

Estrechamente ligada a la variable anterior, la edad medida en meses, al ser una variable num칠rica, puede ser correlacionada directamente con el desempe침o en las Escalas del INDI. 

```{r 45_P3_EDADMES_ESCALAS, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

library(dplyr)
library(knitr)

# Definimos la funci칩n
correlacion_spearman <- function(data, variable_principal, otras_variables) {
  
  # Extraer el nombre de la variable principal desde df$Variable
  nombre_principal <- deparse(substitute(variable_principal)) %>%
    gsub(".*\\$", "", .) # Extrae solo el nombre despu칠s de '$'
  
  # Crear una lista para almacenar los resultados
  resultados <- lapply(otras_variables, function(i) {
    # Extraer el nombre de las otras variables
    variable_otras <- names(data)[i]
    
    # Calcular la correlaci칩n de Spearman
    cor_test <- cor.test(variable_principal, data[[variable_otras]], method = "spearman")
    coef <- cor_test$estimate
    p_value <- cor_test$p.value
    
    # Determinar magnitud de la correlaci칩n
    if (p_value > 0.05) {
      magnitud <- "NS"
      interpretacion <- "Ninguna asociaci칩n estad칤sticamente significativa"
      coef_label <- paste0(round(coef, 2), " NS")
    } else {
      if (abs(coef) < 0.10) {
        magnitud <- "Trivial"
        interpretacion <- "Asociaci칩n trivial"
      } else if (abs(coef) < 0.30) {
        magnitud <- "D칠bil"
        interpretacion <- ifelse(coef > 0, "Asociaci칩n directa", "Asociaci칩n inversa")
      } else if (abs(coef) < 0.50) {
        magnitud <- "Moderada"
        interpretacion <- ifelse(coef > 0, "Asociaci칩n directa", "Asociaci칩n inversa")
      } else {
        magnitud <- "Fuerte"
        interpretacion <- ifelse(coef > 0, "Asociaci칩n directa", "Asociaci칩n inversa")
      }
      # Agregar significancia estad칤stica
      if (p_value <= 0.001) {
        coef_label <- paste0(round(coef, 2), " ***")
      } else if (p_value <= 0.01) {
        coef_label <- paste0(round(coef, 2), " **")
      } else {
        coef_label <- paste0(round(coef, 2), " *")
      }
      interpretacion <- paste(interpretacion, "y estad칤sticamente significativa")
    }
    
    # Crear un dataframe de salida
    tibble(
      Correlaci칩n = paste(nombre_principal, "-", variable_otras),
      `Coef. Spearman` = coef_label,
      Magnitud = magnitud,
      Interpretaci칩n = interpretacion
    )
  })
  
  # Unir los resultados en una tabla y formatearlos con knitr::kable
  resultados <- bind_rows(resultados)
  resultados_kable <- kable(resultados, format = "markdown", align = "clll")
  return(resultados_kable)
}

# Preparo la data
INDI45_AGE <- INDI45_i %>% 
  dplyr::select(Codigo, EDADMES)
PULCRO <- left_join(LIMPIO, INDI45_AGE,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(EDADMES, .before = CSUM)
colnames(PULCRO) <- c("Codigo", "Edad", "Esc_Cog", "Esc_Mot", "Esc_Soc", "Esc_Dis")
# Llamar la funci칩n
corr.age.INDI <- correlacion_spearman(PULCRO, PULCRO$Edad, c(3:6))
print(corr.age.INDI)

```
Estos resultados nos indican que la edad es una variable importante y que, como era de esperar, influye significativamente sobre el desempe침o del INDI. La asociaci칩n detectada es directa en todos los casos; es decir, a mayor edad los resultados en el INDI mejoran. Esto es especialmente cierto en el caso de las escalas Cognitiva y Motriz; algo menos respecto de la escala socioemocional y disposicional.

\newpage

## Regi칩n y Escalas INDI

En esta secci칩n pasaremos a analizar qu칠 diferencias puede hallarse en cuanto a las regionales naturales en las que los participantes fueron evaluados, y su impacto en los puntajes INDI.

```{r 45_P3_Regnat_ESCALAS, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
# Recodificar niveles
INDI45_i$Regnat <- as.factor(INDI45_i$Regnat)
INDI45_i$Regnat <- fct_recode(INDI45_i$Regnat,
                        "Costa" = "1",
                        "Sierra" = "2",
                        "Selva" = "3")
INDI45_REGNAT <- INDI45_i %>% 
  dplyr::select(Codigo, Regnat)
PULCRO <- left_join(LIMPIO, INDI45_REGNAT,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Regnat, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Regi칩n", "Escala_Cog.", "Escala_Mot.", "Escala_Soc","Escala_Dis.")

# Usar la funci칩n trimmed_anova
region.anal <- trimmed_anova(
  df = PULCRO,             # Tu dataframe
  cat_var = "Regi칩n",      # Variable categ칩rica en formato factor
  num_vars = c(3:6),    # 칈ndices de las variables num칠ricas
  trim_level = 0.10        # Nivel de recorte (opcional, por defecto 0.20)
)

# Mostrar el resultado
print(region.anal)

```

La regi칩n donde viven los ni침os en el Per칰 (Costa, Sierra o Selva) tiene un impacto muy grande en su desarrollo cognitivo, motriz, socioemocional y motivacional.

Esto sugiere que factores geogr치ficos, ambientales y socioculturales influyen fuertemente en el desarrollo infantil.

\newpage
### An치lisis Posthoc: Escala Cognitiva seg칰n Regi칩n

Pasaremos a analizar qu칠 impacto espec칤fico en los puntajes de la escala Cognitiva en funci칩n de la regi칩n en la que fue evaluado el participante.

```{r 45_P3_Regnat_posthoc_CSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_CSUM_Regnat <- grafico_promedio(PULCRO, "Escala_Cog.", "Regi칩n", color_contorno = "black", paleta_colores = "Blues", nuevo_nombre_categoria = "Regi칩n")
cat("\n\n")
print(ph_CSUM_Regnat)
# write.csv(PULCRO, file = "Regnat.csv", row.names = FALSE)

ph.csum.reg <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. | p Valor | Interpretaci칩n                           |
|---------|---------|---------------:|--------:|------------------------------------------|
| Costa   | Selva   |          10.77 |   <.001 | Dif. Estad칤sticamente significativa      |
| Costa   | Sierra  |          13.36 |   <.001 | Dif. Estad칤sticamente significativa      |
| Selva   | Sierra  |           2.59 |   0.111 | Sin Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Cog.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.csum.reg)
```
Estos resultados nos indican que la diferencia radica b치sicamente entre la Regi칩n Costa y el resto del Per칰. Las diferencias entre las regiones Sierra y Selva no son estad칤sticamente significativas, mientras que las diferencias entre Costa y cada una de los dos regiones restantes s칤 lo es. 

El desempe침o de los participantes coste침os supera en promedio al de los dem치s participantes, y esta diferencia no es trivial ni casual, sino estad칤sticamente significativa.

\newpage
### An치lisis Posthoc: Escala Motora seg칰n Regi칩n

Pasaremos a analizar qu칠 impacto espec칤fico en los puntajes de la escala Motora en funci칩n de la regi칩n en la que fue evaluado el participante.

```{r 45_P3_Regnat_posthoc_MSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_MSUM_Regnat <- grafico_promedio(PULCRO, "Escala_Mot.", "Regi칩n", color_contorno = "black", paleta_colores = "Greens", nuevo_nombre_categoria = "Regi칩n")
cat("\n\n")
print(ph_MSUM_Regnat)


ph.msum.reg <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. | p Valor | Interpretaci칩n                       |
|---------|---------|---------------:|--------:|--------------------------------------|
| Costa   | Selva   |           1.34 |   <.001 | Dif. Estad칤sticamente significativa  |
| Costa   | Sierra  |           2.92 |   <.001 | Dif. Estad칤sticamente significativa  |
| Selva   | Sierra  |           1.58 |   <.001 | Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.msum.reg)
```
\newpage

### An치lisis Posthoc: Escala Socioemocional seg칰n Regi칩n

Pasaremos a analizar qu칠 impacto espec칤fico en los puntajes de la escala Socioemocional en funci칩n de la regi칩n en la que fue evaluado el participante.

```{r 45_P3_Regnat_posthoc_SSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_SSUM_Regnat <- grafico_promedio(PULCRO, "Escala_Soc", "Regi칩n", color_contorno = "black", paleta_colores = "Purples", nuevo_nombre_categoria = "Regi칩n")
cat("\n\n")
print(ph_SSUM_Regnat)
# write.csv(PULCRO, "RANOVA_S_45.csv", row.names = FALSE)

ph.ssum.reg <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. |  p Valor | Interpretaci칩n                      |
|---------|---------|----------------|----------|-------------------------------------|
| Costa   | Selva   | 1.84           | <.001    | Dif. Estad칤sticamente significativa |
| Costa   | Sierra  | 3.92           | <.001    | Dif. Estad칤sticamente significativa |
| Selva   | Sierra  | 2.08           | <.001    | Dif. Estad칤sticamente significativa |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.ssum.reg)
```

Aunque los ni침os de la Costa y Selva tienen diferencias significativas, estas no son tan marcadas como con la Sierra.

Esto podr칤a indicar que las condiciones de la Costa y Selva comparten m치s similitudes (por ejemplo, acceso a recursos educativos, estilo de vida, infraestructura escolar) en comparaci칩n con la Sierra.


\newpage

### An치lisis Posthoc: Escala Disposicional seg칰n Regi칩n

Pasaremos a analizar qu칠 impacto espec칤fico en los puntajes de la escala Motora en funci칩n de la regi칩n en la que fue evaluado el participante.

```{r 45_P3_Regnat_posthoc_DSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_DSUM_Regnat <- grafico_promedio(PULCRO, "Escala_Dis.", "Regi칩n", color_contorno = "black", paleta_colores = "Oranges", nuevo_nombre_categoria = "Regi칩n")
cat("\n\n")
print(ph_DSUM_Regnat)


ph.dsum.reg <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. | p Valor | Interpretaci칩n                       |
|---------|---------|---------------:|--------:|--------------------------------------|
| Costa   | Selva   |          0.755 |   0.006 | Dif. Estad칤sticamente significativa  |
| Costa   | Sierra  |          2.764 |   <.001 | Dif. Estad칤sticamente significativa  |
| Selva   | Sierra  |          2.010 |   <.001 | Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Dis.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.dsum.reg)
```
\newpage
## 츼rea y Escalas INDI
En esta secci칩n pasaremos a analizar si existe asociaci칩n entre el 치rea en que habita el participante (Urbana vs Rural) y el puntaje obtenido en las Escalas INDI.

```{r 45_P3_Area_ESCALAS, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
# Recodificar niveles
INDI45_i$Area <- as.factor(INDI45_i$Area)
INDI45_i$Area <- fct_recode(INDI45_i$Area,
                        "Urbana" = "1",
                        "Rural" = "2")
INDI45_AREA <- INDI45_i %>% 
  dplyr::select(Codigo, Area)
PULCRO <- left_join(LIMPIO, INDI45_AREA,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Area, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Area", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")

# Usar la funci칩n trimmed_anova
area.anal <- trimmed_anova(
  df = PULCRO,             # Tu dataframe
  cat_var = "Area",      # Variable categ칩rica en formato factor
  num_vars = c(3:6),    # 칈ndices de las variables num칠ricas
  trim_level = 0.10        # Nivel de recorte (opcional, por defecto 0.20)
)

# Mostrar el resultado
print(area.anal)
```

Comprobamos que existe un efecto bastante claro del 치rea sobre el puntaje obtenido en las escalas del INDI. 

Pasemos ahora ver el detalle de esta asociaci칩n.

\newpage
### An치lisis Posthoc: Escala Cognitiva seg칰n 츼rea

Pasaremos a analizar qu칠 impacto espec칤fico en los puntajes de la escala Cognitiva en funci칩n del 츼rea en la que fue evaluado el participante.

```{r 45_P3_Area_posthoc_CSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}

library(ggplot2)
library(RColorBrewer)

grafico_promedio2 <- function(data, var_numerica, var_categorica, 
                             color_contorno = "black", 
                             paleta_colores = "Set3", 
                             nuevo_nombre_categoria = var_categorica) {
  
  # Calcular el promedio de la variable num칠rica por la variable categ칩rica
  resumen <- aggregate(data[[var_numerica]], by = list(data[[var_categorica]]), FUN = mean)
  colnames(resumen) <- c(nuevo_nombre_categoria, "Promedio")
  
  # Crear una paleta de colores din치mica basada en el n칰mero de categor칤as
  colores <- brewer.pal(n = min(length(unique(data[[var_categorica]])), brewer.pal.info[paleta_colores, "maxcolors"]), 
                        name = paleta_colores)
  
  # Crear el gr치fico de barras
  ggplot(resumen, aes_string(x = nuevo_nombre_categoria, y = "Promedio", fill = nuevo_nombre_categoria)) +
    geom_bar(stat = "identity", color = color_contorno, show.legend = FALSE) +
    scale_fill_manual(values = colores) +
    geom_text(aes(label = round(Promedio, 2)), vjust = -0.5) +
    labs(title = paste("Promedio de", var_numerica, "por", nuevo_nombre_categoria),
         x = nuevo_nombre_categoria,
         y = paste("Promedio de", var_numerica)) +
    theme_gray()
}

ph_CSUM_Area <- grafico_promedio2(PULCRO, "Escala_Cog.", "Area", color_contorno = "black", paleta_colores = "Blues", nuevo_nombre_categoria = "Area")
cat("\n\n")
print(ph_CSUM_Area)
# write.csv(PULCRO, file = "Area.csv", row.names = FALSE)
ph_MSUM_Area <- grafico_promedio2(PULCRO, "Escala_Mot.", "Area", color_contorno = "black", paleta_colores = "Greens", nuevo_nombre_categoria = "Area")
cat("\n\n")
print(ph_MSUM_Area)
ph_SSUM_Area <- grafico_promedio2(PULCRO, "Escala_Soc", "Area", color_contorno = "black", paleta_colores = "Purples", nuevo_nombre_categoria = "Area")
cat("\n\n")
print(ph_SSUM_Area)
ph_DSUM_Area <- grafico_promedio2(PULCRO, "Escala_Dis.", "Area", color_contorno = "black", paleta_colores = "Oranges", nuevo_nombre_categoria = "Area")
cat("\n\n")
print(ph_DSUM_Area)

```


En esta ocasi칩n, no es necesario realizar an치lisis posthoc, ya que se trata de una variable con solo ods categor칤as. 

Determinamos que, en todos los casos, los participantes de la zona urbana muestran mejores puntajes que los provenientes de la zona rural. Esta diferencia es estad칤sticamente significativa; es decir, no se trata de un resultado trivial ni  azaroso, sino que m치s biej refleja una propiedad existente en la poblaci칩n general.

\newpage
## Modalidad (Nivmod) y Escalas INDI
En esta secci칩n pasaremos a analizar si existe asociaci칩n entre la modalidad de Educaci칩n Inicial del participante y el puntaje obtenido en las Escalas INDI.

Dado que, como ya se vio previamente en la primera parte de este informe, existe una desproporci칩n muy fuerte entre las categor칤as de esta variable (m치s del 84% de los casos se agrupan en la categor칤a "Jard칤n", mientras que solo algo m치s del 14% pertenece a la categor칤a "Cuna", y apenas algo m치s del 1% a la categor칤a "No Escolarizado"), se decidi칩 suprimir la categor칤a menos frecuente ("No Escolarizado"), y mantener tan solo las otras dos, realizando una comparaci칩n de los promedios de puntaje pp cada grupo as칤 definido. 


### Modalidad (Nivmod) y Escala Cognitiva

Veamos cu치les son las diferencias grupales entre los dos niveles de Modalidad restantes y el puntaje en la Escala Cognitiva:


```{r 45_P3_Nivmod_ESCALA_C, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
# Recodificar niveles
INDI45_i$Nivmod <- as.factor(INDI45_i$Nivmod)
INDI45_i$Nivmod <- fct_recode(INDI45_i$Nivmod,
                        "Jard칤n" = "Inicial - Jard칤n",
                        "No_Esc" = "Inicial - Programa no escolarizado",
                        "Cuna-Jard칤n" = "Inicial - Cuna-jard칤n"
                        )
INDI45_NIVMOD <- INDI45_i %>% 
  dplyr::select(Codigo, Nivmod)
PULCRO <- left_join(LIMPIO, INDI45_NIVMOD,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Nivmod, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Modalidad", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")
# Definimos funci칩n U de MW



prueba_mann_whitney <- function(data, var_numerica, var_factor, nombre_escala) {
  # Extraer los nombres de las variables
  var_numerica_name <- deparse(substitute(var_numerica))
  var_factor_name <- deparse(substitute(var_factor))
  
  # Verificar que la variable categ칩rica tenga exactamente 2 niveles
  niveles <- unique(data[[var_factor]])
  if (length(niveles) != 2) {
    stop("La variable factor debe tener exactamente dos niveles para realizar la prueba.")
  }
  
  # Dividir los datos en los dos grupos
  grupo1 <- data[[var_numerica]][data[[var_factor]] == niveles[1]]
  grupo2 <- data[[var_numerica]][data[[var_factor]] == niveles[2]]
  
  # Ejecutar la prueba de Mann-Whitney-Wilcoxon
  wilcox_result <- wilcox.test(grupo1, grupo2, exact = FALSE, correct = TRUE)
  
  # Calcular la diferencia de promedios
  diff_promedio <- mean(grupo1) - mean(grupo2)
  
  # Determinar la significancia del p-valor
  p_value <- wilcox_result$p.value
  p_label <- if (p_value <= 0.001) {
    paste0(round(p_value, 3), " ***")
  } else if (p_value <= 0.01) {
    paste0(round(p_value, 3), " **")
  } else if (p_value <= 0.05) {
    paste0(round(p_value, 3), " *")
  } else {
    paste0(round(p_value, 3), " NS")
  }
  
  # Interpretaci칩n
  interpretacion <- if (p_value <= 0.05) {
    "Diferencia estad칤sticamente significativa"
  } else {
    "No se encontr칩 una diferencia estad칤sticamente significativa"
  }
  
  # Crear la tabla de resultados
  resultados <- tibble(
    `Grupos Analizados` = paste(niveles[1], "vs", niveles[2]),
    `p-valor` = p_label,
    `Dif. Prom.` = round(diff_promedio, 2),
    Interpretaci칩n = interpretacion
  )
  
  # Crear el t칤tulo de la tabla
  titulo <- paste("An치lisis de Diferencias Grupales - Escala ", nombre_escala, sep = "")
  
  # Generar la tabla con el t칤tulo
  resultados_kable <- kable(resultados, format = "markdown", align = "c", caption = titulo)
  return(resultados_kable)
}


PULQUERRIMO <- PULCRO %>% 
  drop_na() %>% 
  filter(Modalidad !="No_Esc")


# Ejecutar la funci칩n
prueba_mann_whitney(PULQUERRIMO, "Escala_Cog.", "Modalidad", nombre_escala = "Cognitiva")
ph_CSUM_Mod <- grafico_promedio2(PULQUERRIMO, "Escala_Cog.", "Modalidad", color_contorno = "black", paleta_colores = "Blues", nuevo_nombre_categoria = "Modalidad")
cat("\n\n")
print(ph_CSUM_Mod)
# prueba_mann_whitney(PULQUERRIMO, "Escala_Mot.", "Modalidad", nombre_escala = "Motora")
# prueba_mann_whitney(PULQUERRIMO, "Escala_Dis.", "Modalidad", nombre_escala = "Disposicional")
```
Estos resultados nos indican que los participantes con modalidad (la amplia mayor칤a) evidencia un nivel de desempe침o superior al los participantes pertenecientes a la modalidad "Cuna".

Esta diferencia es estad칤sticamente significativa.

\newpage

### Modalidad (Nivmod) y Escala Motora

Veamos cu치les son las diferencias grupales entre los dos niveles de Modalidad restantes y el puntaje en la Escala Motora:

```{r 45_P3_Nivmod_ESCALA_M, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}


# Ejecutar la funci칩n
prueba_mann_whitney(PULQUERRIMO, "Escala_Mot.", "Modalidad", nombre_escala = "Motora")
ph_MSUM_Mod <- grafico_promedio2(PULQUERRIMO, "Escala_Mot.", "Modalidad", color_contorno = "black", paleta_colores = "Greens", nuevo_nombre_categoria = "Modalidad")
cat("\n\n")
print(ph_MSUM_Mod)
# prueba_mann_whitney(PULQUERRIMO, "Escala_Dis.", "Modalidad", nombre_escala = "Disposicional")
```
Como en el caso de la escala Cognitiva, tambi칠n  aqu칤 la diferencia corre a favor la modalidad de Jard칤n, de forma estad칤sticamente significativa.

\newpage


### Modalidad (Nivmod) y Escala Socioemocional

Veamos cu치les son las diferencias grupales entre los dos niveles de Modalidad restantes y el puntaje en la Escala Socioemocional:

```{r 45_P3_Nivmod_ESCALA_S, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}


# Ejecutar la funci칩n
prueba_mann_whitney(PULQUERRIMO, "Escala_Soc", "Modalidad", nombre_escala = "Socioemocional")
ph_SSUM_Mod <- grafico_promedio2(PULQUERRIMO, "Escala_Soc", "Modalidad", color_contorno = "black", paleta_colores = "Purples", nuevo_nombre_categoria = "Modalidad")
cat("\n\n")
print(ph_SSUM_Mod)
# prueba_mann_whitney(PULQUERRIMO, "Escala_Dis.", "Modalidad", nombre_escala = "Disposicional")
```
No se hall칩 diferencias estad칤sticamente significativas.

\newpage


### Modalidad (Nivmod) y Escala Disposicional

Veamos cu치les son las diferencias grupales entre los dos niveles de Modalidad restantes y el puntaje en la Escala Disposicional:

```{r 45_P3_Nivmod_ESCALA_D, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}


# Ejecutar la funci칩n
prueba_mann_whitney(PULQUERRIMO, "Escala_Dis.", "Modalidad", nombre_escala = "Disposicional")
ph_DSUM_Mod <- grafico_promedio2(PULQUERRIMO, "Escala_Dis.", "Modalidad", color_contorno = "black", paleta_colores = "Oranges", nuevo_nombre_categoria = "Modalidad")
cat("\n\n")
print(ph_DSUM_Mod)
# prueba_mann_whitney(PULQUERRIMO, "Escala_Dis.", "Modalidad", nombre_escala = "Disposicional")
```
Como en el caso de la escala Cognitiva, tambi칠n  aqu칤 la diferencia corre a favor la modalidad de Jard칤n, de forma estad칤sticamente significativa.

## Gesti칩n y Escalas INDI

En cuanto a la evaluaci칩n de asociaci칩n entre el tipo de Gesti칩n (p칰blica o privada) y los puntajes en las Escalas INDI, se decidi칩 no realizar el an치lisis, ya que la cantidad de casos de Gesti칩n P칰blica excede el 90%, por lo que estad칤sticamente no tendr칤a mucho sentido hacer comparaciones entre grupos tan desiguales.

## Departamento y Escalas INDI

En donde s칤 tenemos grupos bastante balanceados, es en la variable Departamento. Por lo tanto, es totalmente posible realizar este an치lisis. 

Procedamos a ver los resultados.

```{r 45_P3_DEPA, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results = 'asis'}
# 1. Extraigo los campos categ칩ricos que me interesan del df original
library(dplyr)
INDI45_DEPA <- INDI45_i %>% 
  dplyr::select(Codigo, Reg) 

INDI45_DEPA$Reg <- as.factor(INDI45_DEPA$Reg)

PULCRO <- left_join(LIMPIO, INDI45_DEPA,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Reg, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Departamento", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")

# Usar la funci칩n trimmed_anova
depa.anal <- trimmed_anova(
  df = PULCRO,             # Tu dataframe
  cat_var = "Departamento",      # Variable categ칩rica en formato factor
  num_vars = c(3:6),    # 칈ndices de las variables num칠ricas
  trim_level = 0.10        # Nivel de recorte (opcional, por defecto 0.20)
)

# Mostrar el resultado
print(depa.anal)
# write_csv(PULCRO, "PULCRO_ENCUATRO.CSV")
```

Estos resultados nos indican que, en efecto, existe un fuerte impacto del Departamento sobre el puntaje obtenido en las escalas INDI.

Analicemos el detalle.



### An치lisis Posthoc: Departamento y Escala Cognitiva

Veamos cu치l es la asociaci칩n entre el Departamento y el puntaje en la Escala Cognitiva:

```{r 45_P3_Depa_posthoc_CSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_CSUM_Depa <- grafico_promedio(PULCRO, "Escala_Cog.", "Departamento", color_contorno = "black", paleta_colores = "Blues", nuevo_nombre_categoria = "Departamento")
cat("\n\n")
print(ph_CSUM_Depa)
# write.csv(PULCRO, file = "Depa.csv", row.names = FALSE)

ph.csum.depa <- c("| Grupo 1            | Grupo 2            | Dif. Est. | p Valor | Interpretaci칩n                           |
|--------------------|--------------------|----------:|--------:|------------------------------------------|
| Cusco              | Lima Met. |    -30.46 |   <.001 | Dif. Estad칤sticamente significativa      |
| Cusco              | Loreto             |    -12.34 |   <.001 | Dif. Estad칤sticamente significativa      |
| Cusco              | Piura              |     -9.94 |   <.001 | Dif. Estad칤sticamente significativa      |
| Lima Met. | Loreto             |     18.12 |   <.001 | Dif. Estad칤sticamente significativa      |
| Lima Met. | Piura              |     20.53 |   <.001 | Dif. Estad칤sticamente significativa      |
| Loreto             | Piura              |      2.41 |   0.172 | Sin Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Cog.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.csum.depa)
```

Vemos que los participantes provenientes de Lima ostentan, en todos los casos, una superioridad de desempe침o consistente, en todas las comparaciones. Por otro lado, las diferencias entre el resto de Departamento tambi칠n  son estad칤sticamente significativas, con excepci칩n de los grupos de Loreto y Piura. 

\newpage

### An치lisis Posthoc: Departamento y Escala Motora

Veamos cu치l es la asociaci칩n entre el Departamento y el puntaje en la Escala Motora:

```{r 45_P3_Depa_posthoc_MSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_MSUM_Depa <- grafico_promedio(PULCRO, "Escala_Mot.", "Departamento", color_contorno = "black", paleta_colores = "Greens", nuevo_nombre_categoria = "Departamento")
cat("\n\n")
print(ph_MSUM_Depa)
# write.csv(PULCRO, file = "Depa.csv", row.names = FALSE)

ph.msum.depa <- c("| Grupo 1   | Grupo 2   | Dif. Est. Rec. | p Valor | Interpretaci칩n                       |
|-----------|-----------|---------------:|--------:|--------------------------------------|
| Cusco     | Lima Met. |          -5.54 |   <.001 | Dif. Estad칤sticamente significativa  |
| Cusco     | Loreto    |          -4.22 |   <.001 | Dif. Estad칤sticamente significativa  |
| Cusco     | Piura     |          -2.68 |   <.001 | Dif. Estad칤sticamente significativa  |
| Lima Met. | Loreto    |           1.32 |   <.001 | Dif. Estad칤sticamente significativa  |
| Lima Met. | Piura     |           2.86 |   <.001 | Dif. Estad칤sticamente significativa  |
| Loreto    | Piura     |           1.55 |   <.001 | Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.msum.depa)
```

Vemos que los participantes provenientes de Lima ostentan, en todos los casos, una superioridad de desempe침o consistente, en todas las comparaciones. Lo mismo pasa con las diferencias entre el resto de Departamento; todas son tambi칠n estad칤sticamente significativas.


\newpage


### An치lisis Posthoc: Departamento y Escala Socioemocional

Veamos cu치l es la asociaci칩n entre el Departamento y el puntaje en la Escala Socioemocional:

```{r 45_P3_Depa_posthoc_SSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_SSUM_Depa <- grafico_promedio(PULCRO, "Escala_Soc", "Departamento", color_contorno = "black", paleta_colores = "Purples", nuevo_nombre_categoria = "Departamento")
cat("\n\n")
print(ph_SSUM_Depa)
# write.csv(PULCRO, file = "Depa.csv", row.names = FALSE)

ph.ssum.depa <- c("| Grupo 1            | Grupo 2            | Dif. Est. Rec. |  p Valor | Interpretaci칩n                         |
|--------------------|--------------------|---------------:|---------:|----------------------------------------|
| Cusco              | Lima Metropolitana |         -5.859 |    <.001 | Dif. Estad칤sticamente significativa    |
| Cusco              | Loreto             |         -5.534 |    <.001 | Dif. Estad칤sticamente significativa    |
| Cusco              | Piura              |         -5.013 |    <.001 | Dif. Estad칤sticamente significativa    |
| Lima Metropolitana | Loreto             |          0.324 |    0.608 | Dif. No Estad칤sticamente significativa |
| Lima Metropolitana | Piura              |          0.846 |    0.372 | Dif. No Estad칤sticamente significativa |
| Loreto             | Piura              |          0.522 |    0.608 | Dif. No Estad칤sticamente significativa |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Mot.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.ssum.depa)
```

Los ni침os de Cusco tienen puntajes significativamente m치s bajos en la subescala socioemocional que los de Lima, Loreto y Piura.

No hay diferencias significativas entre Lima Metropolitana, Loreto y Piura, lo que sugiere que estos departamentos comparten condiciones similares en t칠rminos de desarrollo socioemocional.


\newpage


### An치lisis Posthoc: Departamento y Escala Disposicional

Veamos cu치l es la asociaci칩n entre el Departamento y el puntaje en la Escala Cognitiva:

```{r 45_P3_Depa_posthoc_DSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
ph_DSUM_Depa <- grafico_promedio(PULCRO, "Escala_Dis.", "Departamento", color_contorno = "black", paleta_colores = "Oranges", nuevo_nombre_categoria = "Departamento")
cat("\n\n")
print(ph_DSUM_Depa)
# write.csv(PULCRO, file = "Depa.csv", row.names = FALSE)

ph.dsum.depa <- c("| Grupo 1   | Grupo 2   | Dif. Est. Rec. | p Valor | Interpretaci칩n                       |
|-----------|-----------|---------------:|--------:|--------------------------------------|
| Cusco     | Lima Met. |        -3.8914 |   <.001 | Dif. Estad칤sticamente significativa  |
| Cusco     | Loreto    |        -3.8547 |   <.001 | Dif. Estad칤sticamente significativa  |
| Cusco     | Piura     |        -2.9754 |   <.001 | Dif. Estad칤sticamente significativa  |
| Lima Met. | Loreto    |         0.0366 |   0.915 | Sin Dif. Estad칤sticamente significativa  |
| Lima Met. | Piura     |         0.9160 |   0.007 | Dif. Estad칤sticamente significativa  |
| Loreto    | Piura     |         0.8793 |   0.012 | Dif. Estad칤sticamente significativa  |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Dis.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.dsum.depa)
```

En esta Escala las diferencias no son dram치ticas como en el resto; si bien tambi칠n aqu칤 los participantes lime침os siguen evidenciando un desempe침o superior en la amplia amyor칤a de casos, en comparaci칩n con los participantes loretanos la diferencia deja de ser estad칤sticamente significativa.


\newpage


## Quintil de Pobreza y Escalas INDI

Esta es una de las variables de mayor inter칠s en relaci칩n a su posible impacto sobre el desempe침o en las escalas INDI. Examinemos cu치l es. 

```{r 45_P3_Quintil, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results = 'asis'}
# 1. Extraigo los campos categ칩ricos que me interesan del df original
# library(dplyr)
# INDI45_Q <- INDI45 %>% 
#   dplyr::select(Codigo, Quintil) 
# 
# INDI45_Q$Quintil <- as.factor(INDI45_Q$Quintil)
# 
# PULCRO <- left_join(LIMPIO, INDI45_Q,  by = "Codigo")
# PULCRO <- PULCRO %>%
#   relocate(Quintil, .before = CSUM)
# colnames(PULCRO) <- c("C칩digo", "Quintil", "Escala_Cog.", "Escala_Mot.", "Escala_Dis.")
# 
# # Usar la funci칩n trimmed_anova
# quint.anal <- trimmed_anova(
#   df = PULCRO,             # Tu dataframe
#   cat_var = "Quintil",      # Variable categ칩rica en formato factor
#   num_vars = c(3:5),    # 칈ndices de las variables num칠ricas
#   trim_level = 0.10        # Nivel de recorte (opcional, por defecto 0.20)
# )
# 
# # Mostrar el resultado
# print(quint.anal)
# # write_csv(PULCRO, "PULCRO_ENCUATRO.CSV")
# Preparo la data
INDI45_Q <- INDI45_i %>% 
  dplyr::select(Codigo, Quintil)
PULCRO <- left_join(LIMPIO, INDI45_Q,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Quintil, .before = CSUM)
colnames(PULCRO) <- c("Codigo", "Quintil", "Esc_Cog", "Esc_Mot", "Esc_Soc", "Esc_Dis")
# Llamar la funci칩n
corr.quintil.INDI <- correlacion_spearman(PULCRO, PULCRO$Quintil, c(3:5))
print(corr.quintil.INDI)
```

Estos resultados nos indican que, en efecto, existe un impacto del Quintil sobre el puntaje obtenido en las escalas INDI, si bien no es un impacto demasiado se침alado.

## Grado de Instrucci칩n Materna y Escalas INDI

En el caso del grupo de Nivel 4-5, contamos con la informaci칩n del grado de instrucci칩n de la madre del participante. 

Procedamos a ver los resultados.

```{r 45_P3_Grainsmad, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results = 'asis'}
# 1. Extraigo los campos categ칩ricos que me interesan del df original
library(dplyr)
INDI45_GIMA <- INDI45_i %>% 
  dplyr::select(Codigo, Grainsmad) 

INDI45_GIMA$Grainsmad <- as.factor(INDI45_GIMA$Grainsmad)
# Reordenar manualmente
INDI45_GIMA$Grainsmad <- fct_relevel(INDI45_GIMA$Grainsmad, "Ninguno", "Inicial", "Primaria incompleto", "Primaria completo", "Secundaria incompleto", "Secundaria completo","Superior t칠cnico incompleto", "Superior t칠cnico completo","Superior universitario incompleto","Superior universitario completo","Posgrado (maestr칤a, doctorado)")
INDI45_GIMA$Grainsmad  <- fct_recode(INDI45_GIMA$Grainsmad,
                        "1" = "Ninguno",
                        "2" = "Inicial",
                        "3" = "Primaria incompleto",
                        "4" = "Primaria completo",
                        "5" = "Secundaria incompleto",
                        "6" = "Secundaria completo",
                        "7" = "Superior t칠cnico incompleto",
                        "8" = "Superior t칠cnico completo",
                        "9" = "Superior universitario incompleto",
                        "10" = "Superior universitario completo",
                        "11" = "Posgrado (maestr칤a, doctorado)"
                        )
INDI45_GIMA$Grainsmad <- as.numeric(INDI45_GIMA$Grainsmad)
PULCRO <- left_join(LIMPIO, INDI45_GIMA,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Grainsmad, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Educ_Madre", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")

# Llamar la funci칩n
corr.gima.INDI <- correlacion_spearman(PULCRO, PULCRO$Educ_Madre, c(3:6))
print(corr.gima.INDI)
```

Estos resultados nos indican que, en efecto, existe un impacto del Grado de Instrucci칩n de la Madre sobre el puntaje obtenido en las escalas INDI, pero es d칠bil y no afecta a la Escala Motora. La asociaci칩n es directa, lo cual quiere decir que a mayor educaci칩n de la madre, mejor desempe침o del participante en las subescalas Cognitiva, Socioemocional y Disposicional del participante.


\newpage

## Grado de Instrucci칩n Paterna y Escalas INDI

En el caso del grupo de Nivel 4-5, contamos con la informaci칩n del grado de instrucci칩n del padre del participante. 

Procedamos a ver los resultados.

```{r 45_P3_Grainspad, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results = 'asis'}
# 1. Extraigo los campos categ칩ricos que me interesan del df original
library(dplyr)
INDI45_GIPA <- INDI45_i %>% 
  dplyr::select(Codigo, Grainspad) 

INDI45_GIPA$Grainspad <- as.factor(INDI45_GIPA$Grainspad)
# Reordenar manualmente
INDI45_GIPA$Grainspad <- fct_relevel(INDI45_GIPA$Grainspad, "Ninguno", "Inicial", "Primaria incompleto", "Primaria completo", "Secundaria incompleto", "Secundaria completo","Superior t칠cnico incompleto", "Superior t칠cnico completo","Superior universitario incompleto","Superior universitario completo","Posgrado (maestr칤a, doctorado)")
INDI45_GIPA$Grainspad  <- fct_recode(INDI45_GIPA$Grainspad,
                        "1" = "Ninguno",
                        "2" = "Inicial",
                        "3" = "Primaria incompleto",
                        "4" = "Primaria completo",
                        "5" = "Secundaria incompleto",
                        "6" = "Secundaria completo",
                        "7" = "Superior t칠cnico incompleto",
                        "8" = "Superior t칠cnico completo",
                        "9" = "Superior universitario incompleto",
                        "10" = "Superior universitario completo",
                        "11" = "Posgrado (maestr칤a, doctorado)"
                        )
INDI45_GIPA$Grainspad <- as.numeric(INDI45_GIPA$Grainspad)
PULCRO <- left_join(LIMPIO, INDI45_GIPA,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Grainspad, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Educ_Padre", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")

# Llamar la funci칩n
corr.gipa.INDI <- correlacion_spearman(PULCRO, PULCRO$Educ_Padre, c(3:6))
print(corr.gipa.INDI)
```

De forma muy similar al caso de la Educaci칩n Materna, en el caso de la educaci칩n de los padres, existe una asociaci칩n con los puntajes de las escalas INDI, pero es d칠bil (y en el caso de la Escala Motora, desde침able). La asociaci칩n es directa; esto implica que, a mayor educaci칩n del padre, mejor rendimiento en el INDI, espec칤ficamente en las Escalas Cognitiva, Socioemocional y Disposicional.


## Instrucci칩n Previa al Nivel 3 y Escalas INDI

Vamos a determinar si la instrucci칩n previa al Nivel 3 incide o no en los puntajes de las Escalas INDI.


```{r 45_P3_Inst3, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results = 'asis'}
# 1. Extraigo los campos categ칩ricos que me interesan del df original
library(dplyr)
INDI45_I3 <- INDI45_i %>% 
  dplyr::select(Codigo, Insant3a) 

INDI45_I3$Insant3a <- as.factor(INDI45_I3$Insant3a)

PULCRO <- left_join(LIMPIO, INDI45_I3,  by = "Codigo")
PULCRO <- PULCRO %>%
  relocate(Insant3a, .before = CSUM)
colnames(PULCRO) <- c("C칩digo", "Inst_Previa", "Escala_Cog.", "Escala_Mot.", "Escala_Soc", "Escala_Dis.")

# Usar la funci칩n trimmed_anova
i3.anal <- trimmed_anova(
  df = PULCRO,             # Tu dataframe
  cat_var = "Inst_Previa",      # Variable categ칩rica en formato factor
  num_vars = c(3:6),    # 칈ndices de las variables num칠ricas
  trim_level = 0.10        # Nivel de recorte (opcional, por defecto 0.20)
)

# Mostrar el resultado
print(i3.anal)
# write_csv(PULCRO, "PULCRO_i3.CSV")
```
Vemos que la Instrucci칩n Previa al Nivel 3 impacta sobre el INDI, pero solo en la Escala Cognitiva. 

Indaguemos el detalle.

### An치lisis Posthoc: Istrucci칩n Previa y Escala Cognitiva

Veamos cu치l es la asociaci칩n entre la Instrucci칩n Previa al Nivel 3 y el puntaje en la Escala Cognitiva:


```{r 45_P3_i3_posthoc_CSUM, echo=FALSE, message=FALSE, warning=FALSE, paged.print=FALSE, results='asis'}
PULCRO$Inst_Previa  <- fct_recode(PULCRO$Inst_Previa,
                        "No" = "0",
                        "S칤" = "1",
                        "NS/NR" = "2"
                        )

ph_CSUM_i3 <- grafico_promedio(PULCRO, "Escala_Cog.", "Inst_Previa", color_contorno = "black", paleta_colores = "Blues", nuevo_nombre_categoria = "Inst_Previa")
cat("\n\n")
print(ph_CSUM_i3)
write.csv(PULCRO, file = "i3.csv", row.names = FALSE)

ph.csum.i3 <- c("| Grupo 1 | Grupo 2 | Dif. Est. Rec. | p Valor | Interpretaci칩n                           |
|---------|---------|---------------:|--------:|------------------------------------------|
| NS/NR   | No      |           3.41 |   0.032 | Dif. Estad칤sticamente significativa      |
| NS/NR   | S칤      |          -2.41 |   0.170 | Sin Dif. Estad칤sticamente significativa  |
| No      | S칤      |          -5.82 |   <.001 | Dif. Estad칤sticamente significativa      |")

# Retornar la tabla con el t칤tulo y los resultados en formato Markdown
  cat("Resultados An치lisis Posthoc Escala Cog.", "\n\n") # Imprimir el t칤tulo como encabezado
  cat(ph.csum.i3)
```
Algo sorprendentemente, el grupo NS/NR obtuvo un promedio superior al del grupo que no llev칩 Instrucci칩n Previa al Nivel 3, y esta diferencia es estad칤sticamente significativa. Por otrol lado, el grupo que s칤 llev칩 Instrucci칩n Previa al Nivel 3 tuvo un rendimiento superior al grupo que no llev칩 ninguna instrucci칩n previa, y este resultado tambi칠n  es estad칤sticamente significativo.

